

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="es" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="es" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Horizontal Cluster Installation &mdash; documentación de OMniLeads - develop</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Búsqueda" href="search.html" />
    <link rel="next" title="Configuración Inicial" href="initial_settings.html" />
    <link rel="prev" title="Instalación desde ansible remoto" href="install_remote.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OMniLeads
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="what_is_extra.html">WebRTC; la tecnología subyacente de OMniLeads</a></li>
<li class="toctree-l1"><a class="reference internal" href="what_is_extra.html#caracteristicas-y-funcionalidades-de-omnileads">Características y funcionalidades de OMniLeads</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="what_is_use_cases.html">OML como Contact Center integrado a un PBX basado en SIP</a></li>
<li class="toctree-l1"><a class="reference internal" href="what_is_use_cases.html#oml-en-una-compania-de-servicios-de-customer-contact">OML en una Compañia de servicios de Customer Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="what_is_use_cases.html#oml-para-carriers-o-proveedores-de-cloud-pbx">OML para Carriers ó Proveedores de Cloud PBX</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="install.html">Procedimientos de instalación</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="install_self_hosted.html">Ansible Self-Hosted Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="install_remote.html">Instalación desde ansible remoto</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Horizontal Cluster Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#omnileads-in-two">OMniLeads in two:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#omnileads-in-five">OMniLeads in five:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-requisitos">Pre-requisitos</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparacion-en-la-maquina-que-ejecuta-la-instalacion-remota">Preparación en la máquina que ejecuta la instalación remota:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparacion-del-archivo-inventory">Preparación del archivo <em>inventory</em>:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ejecucion-del-script-de-instalacion">Ejecución del script de instalación:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#primer-acceso-a-omnileads">Primer acceso a OMniLeads:</a><ul>
<li class="toctree-l4"><a class="reference internal" href="install_first_access.html">Primer acceso a OMniLeads:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#errores-comunes">Errores comunes:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="initial_settings.html">Configuración Inicial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="telephony.html">Configuración de acceso a la PSTN</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="campaigns.html">Campañas Telefónicas</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="output.html">Metricas, grabaciones y supervisión</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="agent.html">Manual de agente</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="maintance.html">Gestiones del administrador IT</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="known_issues.html">Known Issues</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OMniLeads</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="install.html">Procedimientos de instalación</a> &raquo;</li>
        
      <li>Horizontal Cluster Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/install_cluster.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="horizontal-cluster-installation">
<h1>Horizontal Cluster Installation<a class="headerlink" href="#horizontal-cluster-installation" title="Enlazar permanentemente con este título">¶</a></h1>
<p>OMniLeads puede ser desplegado de manera tal que los componentes queden separados en diferentes hosts. A diferencia de la instalación AIO (All In One)
que despliega todo OMniLeads en un único host, este método de instalación permite dividir la carga de los servicios en más de un host.</p>
<p>Puntualmente existen dos formas de instalar en cluster horizontal:</p>
<div class="section" id="omnileads-in-two">
<h2>OMniLeads in two:<a class="headerlink" href="#omnileads-in-two" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li>Host1 (omlvoip): Asterisk y Kamailio + rtpengine</li>
<li>Host2 (omlapp): Aplicación web, Postgres y Dialer</li>
</ul>
<img alt="_images/install_cluster_in_2.png" src="_images/install_cluster_in_2.png" />
<p><em>Figure 1: Cluster in 2 hosts</em></p>
</div>
<div class="section" id="omnileads-in-five">
<h2>OMniLeads in five:<a class="headerlink" href="#omnileads-in-five" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li>Host1 (omlapp): Aplicación web</li>
<li>Host2 (kamailio): Kamailio + rtpengine</li>
<li>Host3 (asterisk): Asterisk</li>
<li>Host4 (database): Postgresql</li>
<li>Host5 (dialer): Wombat dialer + MySQL</li>
</ul>
<img alt="_images/install_cluster_in_5.png" src="_images/install_cluster_in_5.png" />
<p><em>Figure 2: Cluster in 5 hosts</em></p>
</div>
<div class="section" id="pre-requisitos">
<h2>Pre-requisitos<a class="headerlink" href="#pre-requisitos" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los hosts sobre los cuales vamos a desplegar los servicios en cluster deben cumplir con los siguitens requisitos:</p>
<ul class="simple">
<li>GNU/Linux CentOS 7 (minimal), Debian 9 (netinstall) ó Ubuntu Server 18.04</li>
<li>Al menos 20 GB de espacio en disco</li>
<li>Al menos 4 GB de memoria RAM</li>
<li>Si es <em>Ubuntu / Debian</em>; Instalar el paquete <em>sudo</em>, <em>openssh-server</em> y <em>phyton-minimal</em>, permitir login SSH con el usuario <em>root</em> y reiniciar el servicio de ssh para que se tomen los cambios:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">sudo</span> <span class="n">openssh</span><span class="o">-</span><span class="n">server</span> <span class="n">python</span><span class="o">-</span><span class="n">minimal</span> <span class="o">-</span><span class="n">y</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s/#PermitRootLogin prohibit-password/PermitRootLogin yes/&#39;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssh</span><span class="o">/</span><span class="n">sshd_config</span>
<span class="n">systemctl</span> <span class="n">restart</span> <span class="n">ssh</span>
</pre></div>
</div>
<ul class="simple">
<li>Es muy importante dejar la hora correctamente configurada en cada host.</li>
<li>Configurar una <em>dirección IP</em> y un <em>hostname</em> fijo en cada host destino de la instalación.</li>
</ul>
</div>
<div class="section" id="preparacion-en-la-maquina-que-ejecuta-la-instalacion-remota">
<h2>Preparación en la máquina que ejecuta la instalación remota:<a class="headerlink" href="#preparacion-en-la-maquina-que-ejecuta-la-instalacion-remota" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Al igual que en la instalación «desde ansible remoto», para desplegar OMniLeads en cualquiera de los dos tipos de clusters, debemos proceder con la ejecución
del script de deploy a partir de contar con el proyecto clonado sobre una estación de trabajo con GNU/Linux (deployer). Desde la misma se ejecuta la instalación
del cluster. Para generar nuestro host «deployer», sugerimos repasar el ítem «Preparación en la máquina que ejecuta la instalación remota» dentro de la sección
«instalación desde ansible remoto».</p>
<p>Se considera entonces que el usuario dispone del repositorio clonado en su Linux Workstation (OMniLeads deployer) !</p>
</div>
<div class="section" id="preparacion-del-archivo-inventory">
<h2>Preparación del archivo <em>inventory</em>:<a class="headerlink" href="#preparacion-del-archivo-inventory" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Para este tipo de despliegue, se deben configurar los parámetros <em>hostname</em> y <em>dirección IP</em> de cada host-componente de nuestro cluster.</p>
<ul class="simple">
<li>Ejemplo para <em>OMniLeads in two</em></li>
</ul>
<img alt="_images/install_inventory_net_cluster_in2.png" src="_images/install_inventory_net_cluster_in2.png" />
<p><em>Figure 3: Cluster in 2 hosts, inventory file</em></p>
<p>Como se puede apreciar en la figura 3, se agrupan los componentes Aplicación web + Database + Dialer bajo un <em>hostname</em> y <em>dirección IP</em> por un lado, y por otro lado
Asterisk + Kamailio bajo otro <em>hostname</em> y <em>dirección IP</em>. De esta manera se despliegan dichos componentes en dos hosts destino independientes entre si.</p>
<ul class="simple">
<li>Ejemplo para <em>OMniLeads in five</em></li>
</ul>
<img alt="_images/install_inventory_net_cluster_in5.png" src="_images/install_inventory_net_cluster_in5.png" />
<p><em>Figure 4: Cluster in 5 hosts, inventory file</em></p>
<p>Como se puede apreciar en la figura 4, se separan todos los componentes Aplicación web, Database, Dialer diferentes <em>hostname</em> y <em>dirección IP</em>, ya que cada componente corre
bajo un host dedicado e independiente.</p>
<p>Al igual que en las otras instalaciones, las variables y passwords de los diferentes componentes se pueden modificar en la sección  <em>[everyyone:vars]</em></p>
<img alt="_images/install_inventory_passwords.png" src="_images/install_inventory_passwords.png" />
<p><em>Figure 5: Passwords and parameters of services</em></p>
<ul class="simple">
<li>Introducir el parámetro «time zone» adecuado para su instanacia. Es <strong>Importante</strong> que realice este paso o la instalación no se va a poder realizar.</li>
</ul>
<img alt="_images/install_inventory_timezone.png" src="_images/install_inventory_timezone.png" />
<p><em>Figure 6: inevntory - Time Zone parameter</em></p>
<p>Es importante aclarar que cada vez que se corre el script «./deploy.sh» ya sea para instalar, re-instalar, actualizar, modificar la dirección IP de OML, etc.,
el archivo de inventory se vuelve a «cero». No obstante se genera una copia del archivo (my_inventory), de manera tal que se cuente con los parámetros
del sistema utilizados en la última ejecución del script.
La copia en cuestión se ubica en el path donde ha sido clonado el repositorio de OML y bajo el nombre de «my_inventory» como lo expone la figura 6.</p>
<img alt="_images/install_remote_my_inventory.png" src="_images/install_remote_my_inventory.png" />
<p><em>Figure 7: inevntory copy, my_inventory file</em></p>
</div>
<div class="section" id="ejecucion-del-script-de-instalacion">
<h2>Ejecución del script de instalación:<a class="headerlink" href="#ejecucion-del-script-de-instalacion" title="Enlazar permanentemente con este título">¶</a></h2>
<p>La instalación de OMniLeads se realiza mediante el script <em>deploy.sh</em>, ubicado dentro de la carpeta deploy/ansible con respecto a la carpeta
raíz del proyecto (ominicontacto).</p>
<p>Una vez configuradas las variables citadas, se procede con la ejecución del script de instalación (uitilizando sudo).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">deploy</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<img alt="_images/install_deploysh_cluster.png" src="_images/install_deploysh_cluster.png" />
<p><em>Figure 8: remote root passwords</em></p>
<p>La diferencia respecto de las otras instalacines, es que el script nos pide las contraseñas del usuario <em>root</em> de cada host
destino de la instalación de nuestro cluster.</p>
<p>El tiempo de instalación dependerá mayormente de la velocidad de conexión a internet del host sobre ek que se está corriendo el deplot de  OML,
ya que se deben descargar, instalar y configurar varios paquetes correspondientes a los diferentes componentes de software que conforman el sistema.</p>
<p>Si la ejecución de la instalación finaliza exitosamente, se despliega una vista como la de la figura 8.</p>
<img alt="_images/install_ok_cluster.png" src="_images/install_ok_cluster.png" />
<p><em>Figure 9: OMniLeads installation ended succesfuly</em></p>
</div>
<div class="section" id="primer-acceso-a-omnileads">
<h2>Primer acceso a OMniLeads:<a class="headerlink" href="#primer-acceso-a-omnileads" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Si la ejecución de la instalación fue exitosa, entonces vamos por el primer acceso a OMniLeads.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="install_first_access.html">Primer acceso a OMniLeads:</a></li>
</ul>
</div>
</div>
<div class="section" id="errores-comunes">
<h2>Errores comunes:<a class="headerlink" href="#errores-comunes" title="Enlazar permanentemente con este título">¶</a></h2>
<ul class="simple">
<li>Alguno de los hosts no tiene internet o no resuelve dominios (configuración de DNS).</li>
</ul>
<p><em>Compruebe el acceso a internet de cada host (por ej: actualizando paquetes - apt-get update | yum update).</em></p>
<ul class="simple">
<li>Timeout de algún paquete que se intenta bajar. Puede volver a intentar ejecutar el deploy y si vuelve a fallar, la opción puede ser</li>
</ul>
<p><em>Instalar el paquete desde la terminal.</em></p>
<ul class="simple">
<li>Falla por mala sintaxis o falta de definición de <em>hostname</em> y <em>dirección IP</em> en el archivo <em>inventory</em>.</li>
</ul>
<p><em>Revisar archivo inventorys</em></p>
<ul class="simple">
<li>No se configuró correctamente el acceso ssh del host destino de la instalación.</li>
</ul>
<p><em>Revisar estado del firewall. Comprobar acceso remoto por ssh con el usuario root</em></p>
<ul class="simple">
<li>En caso de contar con algún host Ubuntu-Debian, recordar que se deben instalar paquetes como <em>sudo, openssh-server o python-minimal</em> antes de correr el script de <em>deploy.sh</em></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="initial_settings.html" class="btn btn-neutral float-right" title="Configuración Inicial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="install_remote.html" class="btn btn-neutral float-left" title="Instalación desde ansible remoto" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, omnileads

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>